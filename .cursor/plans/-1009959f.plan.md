<!-- 1009959f-88ce-4a8f-9c6a-4eb02816abfb ed08dafa-a5ff-4493-a670-85f3308bc6e4 -->
# 添加 Pop.menu 智能定位功能

## 问题分析

当前 `Pop.menu` 使用固定的 `anchorOffset` 定位，如果菜单内容宽度或高度较大，可能会溢出屏幕边界。需要添加智能定位逻辑，自动调整位置避免溢出。

## 实现方案

### 1. 修改 `popup_layout.dart` 的定位逻辑

在 `_PopupLayoutState` 中：

- 添加菜单内容的 `GlobalKey` 用于获取实际大小
- 在 `_calculateAnchorPosition()` 后，添加 `_calculateSmartPosition()` 方法
- 计算菜单内容实际大小和屏幕边界
- 如果右边缘会超出屏幕，调整 `left` 值（向右移动或右对齐）
- 如果底部会超出屏幕，调整 `top` 值（向上移动或上对齐）
- 保持左对齐作为首选，仅在必要时调整

### 2. 使用 LayoutBuilder 获取屏幕尺寸

在定位计算时使用 `MediaQuery` 或 `LayoutBuilder` 获取可用屏幕尺寸。

### 3. 添加边距保护

确保菜单与屏幕边缘保持最小间距（如 8-16px），避免贴边显示。

## 文件修改

- `lib/src/widgets/popup_layout.dart`: 添加智能定位计算逻辑

## 注意事项

- 保持左对齐为默认行为，仅在会溢出时才调整
- 动画过程中位置计算可能需要延迟到内容渲染后
- 考虑不同屏幕尺寸和设备方向

### To-dos

- [ ] 在 _PopupLayoutState 中添加菜单内容的 GlobalKey 和状态变量用于存储智能计算后的位置
- [ ] 实现 _calculateSmartPosition() 方法，计算菜单是否溢出屏幕并返回调整后的位置
- [ ] 修改 _buildPopupContent() 使用智能计算后的位置，并添加 LayoutBuilder 获取屏幕尺寸
- [ ] 测试验证智能定位功能在各种屏幕尺寸和菜单大小下的表现